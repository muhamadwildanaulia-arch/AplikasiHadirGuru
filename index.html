<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WebsiteHadir — SDN Muhara</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- Firebase compat (jika kamu masih memakai compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    body { background: #f8fafc; }
    .card { background: white; border-radius: 10px; box-shadow: 0 6px 18px rgba(11,11,13,0.06); }
    .card-smooth { background: white; border-radius: 10px; padding: 1rem; box-shadow: 0 6px 18px rgba(11,11,13,0.04); }
  </style>
</head>
<body class="min-h-screen p-6">
  <div class="max-w-6xl mx-auto">
    <header class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-2xl font-semibold">WebsiteHadir — SDN Muhara</h1>
        <p class="text-sm text-slate-500">Dashboard • Tanpa login</p>
      </div>
      <div class="text-right">
        <div class="text-sm text-slate-600">Tanggal: <span id="nowDate"></span></div>
      </div>
    </header>

    <!-- MAIN GRID -->
    <main class="grid grid-cols-1 md:grid-cols-4 gap-5">
      <!-- Sidebar / Navigation (col-span 1) -->
      <aside class="md:col-span-1 space-y-4">
        <div class="card p-4">
          <h3 class="font-medium">Navigasi</h3>
          <nav class="mt-3 space-y-2 text-sm">
            <button class="w-full text-left py-2 px-3 rounded hover:bg-slate-50" data-nav="dashboard">Dashboard</button>
            <button class="w-full text-left py-2 px-3 rounded hover:bg-slate-50" data-nav="kehadiran">Isi Kehadiran</button>
            <button class="w-full text-left py-2 px-3 rounded hover:bg-slate-50" data-nav="data-guru">Data Guru</button>
          </nav>
        </div>

        <div class="card p-4">
          <h4 class="font-medium">Lokasi Sekolah</h4>
          <p class="text-sm text-slate-500 mt-1">Nama tempat akan tampil bila sudah disimpan.</p>

          <div class="mt-3">
            <label class="block text-xs text-slate-600">Nama Tempat</label>
            <input id="placeName" class="mt-1 block w-full rounded border px-3 py-2 text-sm" placeholder="Contoh: SDN Muhara" />
            <div class="mt-2">
              <label class="block text-xs text-slate-600">Lokasi (otomatis / nama bila ada)</label>
              <input id="lokasi" readonly class="mt-1 block w-full rounded border px-3 py-2 text-sm bg-slate-50" placeholder="Menunggu lokasi..." />
              <div id="coords-small" class="text-xs text-slate-400 mt-1">Koordinat: —</div>
            </div>
            <div class="mt-3 flex gap-2">
              <button id="btnUseGPS" class="flex-1 py-2 rounded bg-slate-100 text-sm">Gunakan GPS</button>
              <button id="btnSavePlace" class="py-2 px-3 rounded bg-emerald-50 text-sm">Simpan</button>
            </div>
          </div>
        </div>

        <div class="card p-4 text-sm text-slate-600">
          <strong>Catatan</strong>
          <ul class="list-disc pl-5 mt-2">
            <li>Nama tempat tersimpan di browser (localStorage).</li>
            <li>Jika nama terisi, yang dikirim sebagai `lokasi` akan menjadi nama tersebut.</li>
          </ul>
        </div>
      </aside>

      <!-- Main content (col-span 3) -->
      <section class="md:col-span-3 space-y-4">
        <!-- Dashboard page -->
        <div id="page-dashboard" class="page card p-4">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-medium">Dashboard</h2>
            <div class="text-sm text-slate-500">Ringkasan</div>
          </div>

          <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3">
            <div class="card-smooth p-4">
              <div class="text-sm text-slate-500">Hadir Hari Ini</div>
              <div id="totalPresent" class="text-2xl font-semibold mt-2">0</div>
            </div>
            <div class="card-smooth p-4">
              <div class="text-sm text-slate-500">Izin / Sakit</div>
              <div id="totalIzin" class="text-2xl font-semibold mt-2">0</div>
            </div>
            <div class="card-smooth p-4">
              <div class="text-sm text-slate-500">Total Guru</div>
              <div id="totalGuru" class="text-2xl font-semibold mt-2">0</div>
            </div>

            <!-- Grafik dipindahkan ke Dashboard (sebelumnya ada di Kehadiran) -->
            <div class="card-smooth p-4 md:col-span-3">
              <h3 class="font-medium text-slate-700">Grafik Kehadiran Mingguan</h3>
              <div class="mt-4">
                <canvas id="chartDashboard" height="160"></canvas>
              </div>
              <div class="mt-3 text-sm text-slate-500">Data real-time dari Firebase (atau data lokal bila offline).</div>
            </div>
          </div>
        </div>

        <!-- Isi Kehadiran page -->
        <div id="page-kehadiran" class="page card p-4 hidden">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-medium">Isi Kehadiran</h2>
            <div class="text-sm text-slate-500">Isi absensi harian</div>
          </div>

          <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm text-slate-700 mb-1">Nama</label>
              <input id="inputNama" class="w-full border rounded p-2" placeholder="Nama / NIP / NIS" />

              <label class="block text-sm text-slate-700 mb-1 mt-3">Keterangan</label>
              <select id="selectStatus" class="w-full border rounded p-2">
                <option value="Hadir">Hadir</option>
                <option value="Izin">Izin</option>
                <option value="Sakit">Sakit</option>
                <option value="Dinas">Dinas</option>
              </select>

              <div class="mt-4">
                <button id="btnKirim" class="py-2 px-4 rounded bg-emerald-600 text-white">Kirim Kehadiran</button>
                <button id="btnReset" class="py-2 px-4 rounded border ml-2">Reset</button>
              </div>
            </div>

            <div>
              <label class="block text-sm text-slate-700 mb-1">Preview Pengiriman</label>
              <div class="border rounded p-3 bg-slate-50 text-sm">
                <div>Nama: <span id="previewNama">—</span></div>
                <div>Status: <span id="previewStatus">Hadir</span></div>
                <div>Lokasi: <span id="previewLokasi">—</span></div>
                <div class="text-xs text-slate-400 mt-2" id="previewCoords">Koordinat: —</div>
              </div>

              <div class="mt-4">
                <h4 class="font-medium text-sm">Riwayat Terbaru</h4>
                <div id="recentList" class="mt-2 text-sm"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Data Guru page (simple table placeholder) -->
        <div id="page-data-guru" class="page card p-4 hidden">
          <h2 class="text-lg font-medium">Data Guru</h2>
          <div class="mt-3 overflow-x-auto">
            <table class="w-full text-sm" id="tableGuru">
              <thead class="text-slate-600">
                <tr><th class="text-left py-2">Nama</th><th class="text-left py-2">NIP</th><th class="text-left py-2">Aksi</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

      </section>
    </main>

    <footer class="mt-6 text-center text-sm text-slate-500">WebsiteHadir • SDN Muhara — vNext</footer>
  </div>

  <!-- App scripts -->
  <!-- load your firebase app logic (app.firebase.js) -->
  <script src="app.firebase.js"></script>

  <script>
    // small UI glue
    document.getElementById('nowDate').textContent = new Date().toLocaleString('id-ID', { dateStyle: 'long' });

    // navigation
    document.querySelectorAll('[data-nav]').forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.getAttribute('data-nav');
        document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
        document.getElementById('page-' + target).classList.remove('hidden');
      });
    });

    // preview update
    const inputNama = document.getElementById('inputNama');
    const selectStatus = document.getElementById('selectStatus');
    const previewNama = document.getElementById('previewNama');
    const previewStatus = document.getElementById('previewStatus');
    const previewLokasi = document.getElementById('previewLokasi');
    const previewCoords = document.getElementById('previewCoords');

    inputNama.addEventListener('input', () => previewNama.textContent = inputNama.value || '—');
    selectStatus.addEventListener('change', () => previewStatus.textContent = selectStatus.value);

    // Hook untuk memperbarui preview lokasi dari app.firebase.js (app akan memanggil window.updatePreviewLocation)
    window.updatePreviewLocation = function (displayText, coordsText) {
      previewLokasi.textContent = displayText || '—';
      previewCoords.textContent = coordsText ? ('Koordinat: ' + coordsText) : 'Koordinat: —';
    };

    // Recent list renderer (app.firebase.js akan memanggil window.renderRecentList)
    window.renderRecentList = function(items) {
      const wrap = document.getElementById('recentList');
      wrap.innerHTML = '';
      if (!items || items.length === 0) {
        wrap.innerHTML = '<div class="text-slate-400">Belum ada riwayat</div>';
        return;
      }
      items.slice(0,20).forEach(it => {
        const d = document.createElement('div');
        d.className = 'py-1 border-b';
        d.innerHTML = `<div class="font-medium">${it.nama || it.name || '—'}</div>
                       <div class="text-xs text-slate-500">${it.waktu || it.time || ''} — ${it.lokasi || ''} — ${it.status || ''}</div>`;
        wrap.appendChild(d);
      });
    };

    // bind send kehadiran -> function sendKehadiran di app.firebase.js
    document.getElementById('btnKirim').addEventListener('click', () => {
      const nama = inputNama.value && inputNama.value.trim();
      const status = selectStatus.value;
      if (!nama) return alert('Masukkan nama terlebih dahulu.');
      if (typeof window.sendKehadiran === 'function') {
        window.sendKehadiran({ nama, status });
      } else {
        alert('Fungsi sendKehadiran belum tersedia (cek app.firebase.js).');
      }
    });

    document.getElementById('btnReset').addEventListener('click', () => {
      inputNama.value = '';
      selectStatus.value = 'Hadir';
      previewNama.textContent = '—';
      previewStatus.textContent = 'Hadir';
    });

    // Save place button (mirror placeName save)
    document.getElementById('btnSavePlace').addEventListener('click', () => {
      const v = (document.getElementById('placeName').value || '').trim();
      try { localStorage.setItem('wh_place_name', v); alert('Nama tempat disimpan.'); } catch(e){ alert('Gagal menyimpan.'); }
      // ask app.firebase.js to refresh preview if function exists
      if (typeof window.requestLocationRefresh === 'function') window.requestLocationRefresh();
    });

    // Use GPS button
    document.getElementById('btnUseGPS').addEventListener('click', () => {
      if (typeof window.forceGeolocation === 'function') {
        window.forceGeolocation();
      } else {
        alert('Fungsi GPS tidak tersedia (cek app.firebase.js).');
      }
    });

    // table guru renderer (app.firebase.js akan memanggil window.renderGuruTable)
    window.renderGuruTable = function(list) {
      const tbody = document.querySelector('#tableGuru tbody');
      tbody.innerHTML = '';
      (list||[]).forEach(g => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="py-2">${g.nama||g.name||''}</td><td class="py-2">${g.nip||''}</td><td class="py-2">-</td>`;
        tbody.appendChild(tr);
      });
      document.getElementById('totalGuru').textContent = (list && list.length) ? list.length : 0;
    };

    // when script loads, show dashboard
    document.querySelector('[data-nav="dashboard"]').click();
  </script>
</body>
</html>
