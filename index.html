<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WebsiteHadir â€” SDN Muhara (Dashboard)</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js & XLSX -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

  <!-- Firebase compat (pastikan versi sesuai kebutuhan) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <!-- ADDED: Auth compat (important if you use firebase.auth() or rules that require auth) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>

  <link rel="icon" type="image/png" href="Logo.png">

  <style>
    .sidebar { background: linear-gradient(180deg,#7f1d1d,#b91c1c); }
    .card-smooth { background: linear-gradient(180deg,#fff,#f8fafc);
      border-radius:12px; box-shadow:0 6px 22px rgba(15,23,42,0.06); }
    #toasts { position: fixed; right: 20px; bottom: 20px; z-index: 60;
      display: flex; flex-direction: column; gap: 8px; pointer-events:none; }
    .toast { pointer-events:auto; padding:10px 14px; border-radius:10px;
      box-shadow:0 6px 18px rgba(2,6,23,0.12); transition: all .2s;
      opacity:0; transform:translateY(8px) scale(.98); }
    .toast.show{opacity:1;transform:none;}
    .toast.ok{background:#ecfdf5;color:#065f46;}
    .toast.err{background:#fff1f2;color:#9f1239;}
    .toast.info{background:#f8fafc;color:#0f172a;}
  </style>
</head>
<body class="antialiased bg-slate-50 text-slate-800">
  <div class="min-h-screen flex">
    <!-- SIDEBAR -->
    <aside class="sidebar hidden md:flex md:flex-col md:w-64 md:py-6 md:px-4">
      <div class="flex items-center gap-3 mb-6">
        <img src="Logo.png" alt="Logo SDN Muhara" class="h-12 w-12 rounded-md shadow-sm bg-white p-1" />
        <div>
          <h1 class="text-white font-bold">SDN Muhara</h1>
          <div class="text-sm text-red-200 italic">WebsiteHadir â€¢ Dashboard</div>
        </div>
      </div>
      <nav class="mt-6 flex-1">
        <ul class="space-y-1">
          <li><button data-page="kehadiran" class="nav-item w-full text-left px-3 py-2 rounded-md hover:bg-white/10">ğŸ“¥ Isi Kehadiran</button></li>
          <li><button data-page="dashboard" class="nav-item w-full text-left px-3 py-2 rounded-md hover:bg-white/10">ğŸ“Š Dashboard</button></li>
          <li><button data-page="guru" class="nav-item w-full text-left px-3 py-2 rounded-md hover:bg-white/10">ğŸ‘©â€ğŸ« Data Guru</button></li>
          <li><button data-page="laporan" class="nav-item w-full text-left px-3 py-2 rounded-md hover:bg-white/10">ğŸ“… Laporan Bulanan</button></li>
        </ul>
      </nav>
      <div class="mt-auto text-sm text-red-100 px-3">Versi demo â€¢ 2025</div>
    </aside>

    <!-- MOBILE NAV -->
    <div class="md:hidden fixed bottom-3 left-1/2 -translate-x-1/2 bg-white/95 shadow-lg rounded-full px-3 py-1 z-40 flex gap-2">
      <button data-page="kehadiran" class="px-3 py-2 rounded-full text-sm">ğŸ“¥</button>
      <button data-page="dashboard" class="px-3 py-2 rounded-full text-sm">ğŸ“Š</button>
      <button data-page="guru" class="px-3 py-2 rounded-full text-sm">ğŸ‘©â€ğŸ«</button>
      <button data-page="laporan" class="px-3 py-2 rounded-full text-sm">ğŸ“…</button>
    </div>
    <!-- MAIN CONTENT (lanjutan) -->
    <div class="flex-1 min-w-0">

      <!-- TOPBAR -->
      <header class="flex items-center justify-between bg-white/80 backdrop-blur sticky top-0 z-30 border-b border-slate-200 px-4 py-3">
        <div class="flex items-center gap-4">
          <button id="btn-toggle-sidebar" class="md:hidden p-2 rounded bg-white/60">â˜°</button>
          <div>
            <div class="text-sm text-slate-500" id="current-date-top"></div>
            <div class="text-lg font-semibold">Dashboard Kehadiran</div>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <div id="admin-badge" class="hidden items-center gap-2 bg-red-50 text-red-700 px-2 py-1 rounded text-sm">Admin Aktif</div>
          <div class="flex items-center gap-3">
            <div id="clock-small" class="text-sm text-slate-600"></div>
            <button id="btn-open-admin" class="text-sm px-3 py-1 rounded bg-rose-600 text-white hidden md:inline">Login Admin</button>
            <button id="btn-admin-logout" class="text-sm text-slate-600 underline hidden md:inline">Logout</button>
          </div>
        </div>
      </header>

      <main class="p-6">
        <div class="max-w-7xl mx-auto">

          <!-- GRID / HEADER CARDS -->
          <div id="page-dashboard" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 hidden">
            <div class="card-smooth p-5">
              <div class="text-sm text-slate-500">Total Guru</div>
              <div id="totalGuru" class="text-3xl font-bold text-slate-800 mt-2">0</div>
            </div>
            <div class="card-smooth p-5">
              <div class="text-sm text-slate-500">Hadir Hari Ini</div>
              <div id="totalHadir" class="text-3xl font-bold text-green-600 mt-2">0</div>
            </div>
            <div class="card-smooth p-5">
              <div class="text-sm text-slate-500">Izin / Sakit / Dinas</div>
              <div id="totalLain" class="text-3xl font-bold text-amber-600 mt-2">0</div>
            </div>
          </div>

          <!-- Kehadiran Form -->
          <section id="page-kehadiran" class="">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="card-smooth p-6">
                <h2 class="text-xl font-semibold mb-2">ğŸ“¥ Isi Kehadiran Guru</h2>
                <p class="text-sm text-slate-500 mb-4">Pilih nama lalu kirim kehadiran. Tetap tanpa login untuk guru biasa.</p>

                <div class="space-y-4">
                  <div>
                    <label for="namaGuru" class="block text-sm text-slate-700 mb-1">Nama Guru</label>
                    <select id="namaGuru" class="w-full border rounded p-2" aria-label="Pilih nama guru">
                      <option value="">-- Pilih Guru --</option>
                    </select>
                  </div>

                  <div>
                    <label for="statusKehadiran" class="block text-sm text-slate-700 mb-1">Status Kehadiran</label>
                    <select id="statusKehadiran" class="w-full border rounded p-2" aria-label="Pilih status kehadiran">
                      <option value="">-- Pilih Status --</option>
                      <option value="Hadir">Hadir</option>
                      <option value="Izin">Izin</option>
                      <option value="Sakit">Sakit</option>
                      <option value="Dinas Luar">Dinas Luar</option>
                    </select>
                  </div>

                  <div>
                    <label class="block text-sm text-slate-700 mb-1">Lokasi (otomatis)</label>
                    <div class="flex gap-2">
                      <input id="lokasi" readonly class="flex-1 border rounded p-2 bg-slate-50 text-slate-600" placeholder="Tekan 'Gunakan GPS' untuk mendeteksi lokasi" />
                      <button id="btn-use-gps" class="px-3 py-2 rounded bg-rose-600 text-white text-sm flex items-center gap-2" title="Gunakan GPS">
                        <span id="btn-gps-icon">ğŸ“</span>
                        <span id="btn-gps-label">Gunakan GPS</span>
                      </button>
                    </div>
                    <div id="coords-small" class="text-xs text-slate-400 mt-1">â€”</div>
                  </div>

                  <!-- Foto (opsional, hanya cache lokal) + kamera -->
                  <div>
                    <label class="block text-sm text-slate-700 mb-1">Foto (opsional, disimpan lokal)</label>
                    <div class="flex gap-2 items-center">
                      <input id="photoInput" accept="image/*" capture="environment" type="file" class="text-sm" />
                      <button id="btn-open-camera" class="px-3 py-2 rounded bg-sky-600 text-white text-sm">ğŸ“· Kamera</button>
                      <button id="btn-clear-photo" class="px-2 py-1 rounded bg-slate-100 text-sm">Hapus</button>
                    </div>
                    <div class="mt-2">
                      <img id="photoPreview" src="" alt="Preview foto" class="max-h-36 rounded border hidden" />
                      <div id="photoHint" class="text-xs text-slate-400 mt-1">Foto hanya tersimpan di perangkat Anda (IndexedDB).</div>
                    </div>
                  </div>

                  <div class="flex gap-3 items-center">
                    <button id="kirimKehadiranBtn" class="bg-rose-600 hover:bg-rose-700 text-white px-4 py-2 rounded">ğŸš€ Kirim Kehadiran</button>
                    <div id="kehadiran-status" class="text-sm text-slate-500">â€”</div>
                  </div>
                </div>
              </div>

              <div class="card-smooth p-6">
                <h3 class="font-semibold">Grafik Kehadiran Hari Ini</h3>
                <div class="mt-4">
                  <canvas id="chartDashboard" height="180"></canvas>
                </div>
                <div class="mt-6">
                  <h4 class="font-medium text-slate-700 mb-2">Aktivitas Terbaru</h4>
                  <div id="recent-activity" class="space-y-1 text-slate-700 text-sm">
                    <p class="text-slate-400">Memuat data...</p>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Data Guru -->
          <section id="page-guru" class="hidden">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xl font-semibold">ğŸ‘©â€ğŸ« Daftar Guru</h2>
              <div id="admin-controls-placeholder"></div>
            </div>

            <div class="card-smooth p-4">
              <table class="w-full">
                <thead>
                  <tr class="text-left">
                    <th class="p-2">NIP</th>
                    <th class="p-2">Nama</th>
                    <th class="p-2">Jabatan</th>
                    <th class="p-2">Status</th>
                    <th class="p-2">Aksi</th>
                  </tr>
                </thead>
                <tbody id="guruTableBody">
                  <tr><td colspan="5" class="text-center p-6 text-slate-500">Memuat...</td></tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- Laporan -->
          <section id="page-laporan" class="hidden">
            <div class="card-smooth p-6">
              <h2 class="text-xl font-semibold mb-4">ğŸ“¥ Laporan Bulanan</h2>
              <div class="flex gap-3 items-center">
                <select id="bulan" class="border p-2 rounded">
                  <option value="">-- Pilih Bulan --</option>
                  <!-- contoh value format YYYY-MM -->
                  <option value="2025-11">November 2025</option>
                  <option value="2025-10">Oktober 2025</option>
                </select>
                <button onclick="downloadLaporan('https://your-cloud-function.example.net/laporan')" class="px-3 py-2 rounded bg-emerald-600 text-white">Download (Admin)</button>
                <div class="text-xs text-slate-500">Catatan: tombol ini memanggil Cloud Function protected (admin only).</div>
              </div>
            </div>
          </section>

        </div>
      </main>
    </div>
  </div>

  <!-- Toast container -->
  <div id="toasts"></div>

   <!-- Firebase compat (pastikan dimuat SEBELUM app.firebase.js) -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>

  <script src="app.firebase.js"></script>
</body>
</html>
